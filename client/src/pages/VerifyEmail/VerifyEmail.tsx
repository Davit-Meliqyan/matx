// src/pages/VerifyEmail.tsx
import { useEffect, useState } from "react";
import { useSearchParams, useNavigate } from "react-router-dom";

export default function VerifyEmail() {
  const [status, setStatus] = useState<"loading" | "success" | "error">(
    "loading"
  );
  const [message, setMessage] = useState("");
  const [searchParams] = useSearchParams();
  const navigate = useNavigate();

  useEffect(() => {
    const token = searchParams.get("token");

    if (!token) {
      setStatus("error");
      setMessage("Token not found in link");
      return;
    }

    fetch(`/api/auth/verify-email?token=${token}`)
      .then((res) => res.json()) // ✅ ожидаем JSON
      .then((data) => {
        if (data.message) {
          setStatus("success");
          setMessage(data.message);
          setTimeout(() => navigate("/sign-in"), 3000); // через 3 сек. переход на вход
        } else {
          setStatus("error");
          setMessage("Unexpected server response");
        }
      })
      .catch((err) => {
        console.error(err);
        setStatus("error");
        setMessage("Verification error or token expired");
      });
  }, [searchParams, navigate]);


  return (
    <div className="h-screen p-5 relative bg-[#ffffff] dark:bg-[#1c1c1d] flex justify-start items-start flex-col">
      <svg
        width="100%"
        height="100%"
        viewBox="0 0 539 549"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="h-auto"
      >
        <path
          d="M176.327 11.2623C176.337 23.0618 176.445 34.3952 176.296 45.7253C176.248 49.3644 177.452 50.756 181.192 50.7084C193.689 50.5493 206.191 50.5241 218.686 50.7303C222.809 50.7983 223.758 49.0714 223.706 45.3512C223.546 33.8546 223.633 22.3543 223.661 10.8556C223.677 4.01323 226.611 0.650334 232.457 0.658802C237.738 0.666447 241.163 4.34462 241.244 10.6401C241.394 22.3038 241.417 33.9715 241.287 45.6352C241.247 49.2163 242.338 50.7416 246.124 50.6966C258.788 50.5459 271.455 50.5595 284.119 50.7035C287.742 50.7447 288.692 49.1256 288.67 45.86C288.594 34.8618 288.665 23.8625 288.713 12.8639C288.72 11.2046 288.699 9.50219 289.044 7.89548C290.076 3.08568 293.775 0.313313 298.38 0.691715C303.131 1.08217 306.212 4.18708 306.276 9.32805C306.425 21.325 306.489 33.3277 306.265 45.3221C306.187 49.4939 307.565 50.8976 311.699 50.7203C319.851 50.3708 327.979 50.5237 335.87 53.2452C353.801 59.4289 365.934 76.2231 366.134 96.1069C366.362 118.769 366.248 141.435 366.217 164.099C366.208 171.086 363.321 174.358 357.479 174.376C351.733 174.393 348.707 170.974 348.692 164.092C348.641 141.761 348.704 119.43 348.655 97.0988C348.618 80.4455 336.676 68.3414 320.082 68.3247C262.422 68.2669 204.759 68.5873 147.102 68.1108C131.28 67.98 116.247 79.4427 116.302 99.3672C116.455 154.694 116.357 210.022 116.338 265.35C116.337 267.863 116.622 270.292 117.21 272.75C120.683 287.286 131.537 296.537 146.535 296.578C203.862 296.734 261.19 296.773 318.517 296.56C335.944 296.496 348.603 283.173 348.651 265.859C348.704 246.861 348.669 227.863 348.678 208.865C348.679 206.705 348.689 204.589 349.529 202.486C351.017 198.766 353.862 196.834 357.596 196.872C361.57 196.912 364.616 198.957 365.57 203.133C365.973 204.895 366.212 206.736 366.216 208.542C366.253 227.373 366.237 246.205 366.217 265.036C366.186 294.916 344.103 312.329 322.294 313.595C307.294 314.466 292.323 313.879 277.341 314.138C266.845 314.318 256.344 314.225 245.845 314.152C242.819 314.131 241.228 314.995 241.295 318.412C241.456 326.741 241.456 335.078 241.299 343.407C241.236 346.769 242.663 347.682 245.784 347.675C278.447 347.608 311.123 348.205 343.77 347.489C386.616 346.549 415.896 313.708 422.257 280.595C423.348 274.918 422.874 269.066 422.831 263.249C422.561 226.588 422.621 189.924 422.705 153.261C422.727 143.495 430.303 137.055 439.861 138.137C441.856 138.363 442.902 139.289 442.996 141.278C443.051 142.442 443.111 143.608 443.11 144.774C443.106 186.103 443.316 227.433 443.022 268.76C442.725 310.576 412.276 350.165 372.146 361.739C362.33 364.57 352.3 366.061 342.129 366.097C306.8 366.219 271.47 366.157 236.14 366.134C225.562 366.127 223.67 364.182 223.663 353.617C223.656 342.118 223.545 330.617 223.713 319.121C223.766 315.499 222.659 314.052 218.895 314.1C205.898 314.267 192.898 314.261 179.9 314.157C176.416 314.13 175.256 315.478 175.296 318.897C175.437 331.061 175.368 343.228 175.357 355.393C175.352 361.938 172.425 365.722 167.285 365.906C162.264 366.086 158.326 362.321 158.18 356.097C157.892 343.773 158.093 331.437 158.091 319.106C158.091 317.791 158.091 316.475 158.091 314.624C151.977 313.536 145.822 314.26 139.777 313.494C117.275 310.643 99.8778 291.619 99.6431 268.984C99.4833 253.582 99.8191 256.094 86.2625 255.884C76.9347 255.739 67.6042 255.724 58.2783 255.504C52.301 255.363 49.5874 252.519 49.6767 246.905C49.7613 241.584 52.8615 238.687 58.7018 238.665C70.3671 238.621 82.0359 238.493 93.6964 238.734C97.96 238.823 99.1862 237.189 99.1369 233.194C98.9828 220.697 98.986 208.196 99.1335 195.7C99.1762 192.085 98.1072 190.767 94.2843 190.813C82.2928 190.959 70.2898 190.915 58.3048 190.525C51.9587 190.319 49.4308 187.215 49.6836 181.412C49.9098 176.219 52.9414 173.703 59.1812 173.681C70.5132 173.641 81.8486 173.506 93.176 173.736C97.37 173.821 99.1387 172.756 99.1349 168.206C99.125 156.215 98.6661 144.214 99.4958 132.226C99.77 128.265 98.3664 126.172 93.7426 126.29C82.4181 126.579 71.0806 126.409 59.7487 126.344C53.2232 126.307 49.7898 123.324 49.7009 117.833C49.6175 112.676 52.9114 109.298 59.1366 109.141C70.2957 108.861 81.4687 108.822 92.6285 109.048C97.1834 109.14 99.3 107.973 99.3006 103.007C99.3016 95.3943 99.2828 87.7735 102.054 80.3784C108.522 63.1213 125.449 50.9148 143.87 50.6694C147.035 50.6272 150.221 50.4393 153.364 50.7058C157.653 51.0695 158.782 49.1469 158.719 45.1495C158.534 33.4871 158.578 21.8189 158.692 10.1545C158.761 3.1653 164.096 -0.999691 170.265 1.01723C174.929 2.54215 176.454 6.2022 176.327 11.2623Z"
          fill="white"
          className="svg-elem-1"
        />
        <path
          d="M214 108.723C237.498 108.723 260.496 108.712 283.494 108.725C299.106 108.735 307.317 116.88 307.32 132.334C307.327 165.998 307.332 199.662 307.326 233.325C307.323 247.371 299.426 255.367 285.419 255.381C250.089 255.418 214.759 255.42 179.428 255.392C165.945 255.382 158.087 248.146 157.989 234.544C157.737 199.882 157.748 165.216 158.013 130.555C158.12 116.648 166.648 108.776 180.503 108.714C191.502 108.665 202.501 108.716 214 108.723ZM182.786 126.379C175.777 126.484 175.351 126.891 175.35 133.718C175.348 165.691 175.351 197.663 175.362 229.636C175.365 237.785 176.137 238.625 184.096 238.627C216.901 238.636 249.706 238.614 282.511 238.58C288.849 238.573 289.668 237.738 289.671 231.358C289.683 198.719 289.68 166.081 289.667 133.442C289.664 126.62 289.438 126.389 282.635 126.387C249.663 126.374 216.691 126.381 182.786 126.379Z"
          fill="white"
          className="svg-elem-2"
        />
        <path
          d="M400.35 493C400.347 509.991 400.236 526.483 400.416 542.971C400.46 547.047 399.253 548.69 395.047 548.401C388.419 547.948 381.052 550.254 375.317 547.498C369.752 544.824 367.099 537.761 363.273 532.553C347.304 510.819 331.424 489.02 315.503 467.251C314.24 465.524 312.908 463.848 311.361 461.827C309.852 463.885 310.388 465.893 310.384 467.717C310.335 492.536 310.236 517.356 310.438 542.174C310.477 546.872 309.3 548.859 304.342 548.41C300.046 548.021 295.672 548.115 291.361 548.406C287.059 548.696 285.538 547.233 285.586 542.769C285.793 523.449 285.67 504.125 285.67 484.802C285.67 466.313 285.786 447.822 285.591 429.335C285.545 425.029 286.74 423.303 291.226 423.601C296.367 423.943 301.552 423.812 306.71 423.633C309.737 423.528 311.602 424.774 313.297 427.18C332.768 454.804 352.315 482.374 371.859 509.947C372.778 511.244 373.47 512.798 375.648 513.718C375.648 510.815 375.648 508.206 375.648 505.597C375.652 480.278 375.746 454.958 375.574 429.641C375.544 425.175 376.699 423.245 381.438 423.655C385.737 424.027 390.11 423.978 394.419 423.671C398.911 423.351 400.497 424.844 400.447 429.536C400.222 450.522 400.35 471.512 400.35 493Z"
          fill="white"
          className="svg-elem-3"
        />
        <path
          d="M505 525.655C514.667 525.659 523.836 525.781 532.999 525.608C536.66 525.539 538.145 526.808 537.963 530.521C537.76 534.677 537.787 538.86 538.004 543.016C538.222 547.192 536.424 548.428 532.379 548.399C511.547 548.251 490.713 548.339 469.88 548.341C459.047 548.342 448.21 548.182 437.382 548.41C433.169 548.498 431.554 547.388 431.573 542.838C431.737 504.839 431.707 466.839 431.598 428.839C431.587 425.013 432.665 423.575 436.672 423.591C468.838 423.72 501.005 423.716 533.171 423.609C537.04 423.596 538.628 424.781 538.377 428.771C538.105 433.087 538.071 437.451 538.374 441.762C538.681 446.128 536.67 447.112 532.761 447.096C510.261 447.001 487.761 447.068 465.261 447.103C455.294 447.119 456.415 446.326 456.354 455.919C456.325 460.419 456.7 464.953 456.258 469.41C455.734 474.692 457.908 475.81 462.8 475.753C483.463 475.514 504.131 475.65 524.798 475.669C531.305 475.675 531.309 475.705 531.335 482.327C531.346 485.16 531.051 488.03 531.404 490.819C532.078 496.149 529.57 497.209 524.79 497.162C504.293 496.964 483.792 497.093 463.292 497.085C456.177 497.082 456.184 497.057 456.198 504.27C456.209 509.604 456.411 514.948 456.131 520.267C455.915 524.368 457.297 525.801 461.501 525.738C475.831 525.524 490.167 525.656 505 525.655Z"
          fill="white"
          className="svg-elem-4"
        />
        <path
          d="M32.0227 496.363C28.363 496.307 25.1575 496.558 22.0415 496.141C9.024 494.399 0.703031 484.702 0.647031 471.444C0.616041 464.112 0.620175 456.78 0.6405 449.449C0.682553 434.282 10.3065 423.998 25.3392 423.865C50.6652 423.64 75.995 423.897 101.323 423.788C105.311 423.771 106.629 425.264 106.398 429.089C106.158 433.074 106.079 437.107 106.415 441.078C106.806 445.69 105.045 447.17 100.483 447.111C84.6558 446.906 68.8242 447.049 52.9942 447.033C44.8298 447.024 36.6578 447.151 28.5047 446.828C24.9461 446.687 24.2379 448.124 24.3146 451.183C24.4523 456.679 24.6081 462.196 24.2688 467.674C23.9868 472.228 25.5029 473.789 30.1608 473.739C49.6545 473.531 69.1521 473.602 88.6477 473.683C99.854 473.729 109.407 480.027 111.495 490.239C114.24 503.668 114.248 517.467 111.618 530.918C109.624 541.122 99.8965 548.21 89.2139 548.274C61.554 548.437 33.8923 548.295 6.23173 548.387C2.76965 548.399 1.44925 547.165 1.61703 543.712C1.81897 539.556 1.93098 535.361 1.58981 531.223C1.21895 526.725 3.03311 525.549 7.31796 525.576C32.3118 525.732 57.3084 525.515 82.3009 525.753C87.2945 525.8 89.1765 524.543 88.79 519.356C88.3455 513.39 88.4582 507.355 88.7541 501.371C88.9564 497.277 87.3183 496.265 83.5065 496.299C66.5115 496.451 49.5144 496.364 32.0227 496.363Z"
          fill="white"
          className="svg-elem-5"
        />
        <path
          d="M227.892 515.33C209.255 515.33 191.101 515.437 172.949 515.244C169.029 515.202 167.379 516.704 166.379 520.284C164.189 528.127 161.557 535.845 159.279 543.665C158.302 547.022 156.585 548.581 152.884 548.433C146.432 548.175 139.962 548.361 133.813 548.361C132.212 545.696 133.568 543.892 134.182 542.126C146.258 507.421 158.21 472.675 169.494 437.701C173.31 425.877 176.634 423.643 189.107 423.647C198.101 423.651 207.094 423.652 216.088 423.659C226.301 423.668 230.103 426.268 233.422 435.986C241.427 459.429 249.351 482.899 257.269 506.37C261.359 518.493 265.365 530.643 269.41 542.78C269.93 544.34 270.819 545.833 270.044 548.258C263.175 548.258 256.075 548.298 248.976 548.235C246.636 548.214 246.155 546.25 245.596 544.491C243.333 537.362 241.076 530.231 238.82 523.099C235.86 513.744 236.929 515.515 227.892 515.33ZM218.862 464.451C218.44 463.193 218.107 461.897 217.582 460.685C215.615 456.148 215.794 449.842 211.812 447.274C207.709 444.627 201.781 446.747 196.675 446.351C193.162 446.078 191.267 447.298 190.154 450.835C186.319 463.016 182.166 475.097 178.132 487.215C177.72 488.452 176.963 489.671 178.25 491.311C194.497 491.311 211.017 491.311 228.339 491.311C225.154 482.272 222.143 473.729 218.862 464.451Z"
          fill="white"
          className="svg-elem-6"
        />
        <path
          d="M453.049 67.397C444.649 67.3574 444.646 67.3574 444.641 59.6304C444.635 50.489 444.747 41.3456 444.575 32.2074C444.509 28.7067 445.838 27.5598 449.243 27.6063C459.712 27.7493 470.185 27.7446 480.655 27.6178C483.994 27.5773 485.441 28.6191 485.386 32.1692C485.224 42.4715 485.246 52.7788 485.367 63.0821C485.406 66.326 484.149 67.4651 480.965 67.4233C471.825 67.3033 462.682 67.3912 453.049 67.397Z"
          fill="white"
          className="svg-elem-7"
        />
        <path
          d="M393.657 110.972C393.662 102.337 393.759 94.195 393.629 86.0569C393.578 82.8859 394.693 81.591 397.943 81.6267C408.408 81.7416 418.875 81.7285 429.34 81.6292C432.402 81.6001 433.385 82.9214 433.359 85.8247C433.267 96.29 433.23 106.758 433.361 117.222C433.404 120.612 431.882 121.448 428.826 121.412C419.358 121.301 409.888 121.392 400.418 121.376C393.673 121.365 393.673 121.344 393.656 114.457C393.654 113.46 393.656 112.463 393.657 110.972Z"
          fill="white"
          className="svg-elem-8"
        />
      </svg>

      <div className="fixed top-0 left-0 w-full h-full flex justify-center items-center bg-[#b9b8b89f]">
        <div className=" text-center">
          <h2 className="text-4xl font-bold">Email confirmation</h2>
          {status === "loading" && <p className="text-xl font-medium">We confirm...</p>}
          {status !== "loading" && <p className="text-xl font-medium">{message}</p>}
        </div>
      </div>
    </div>
  );
}
